
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="tutorial/">
      
      
      <link rel="icon" href="assets/images/SIB_logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Docs on hosting containers on AWS for teaching</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hosting-containers-on-aws-for-teaching" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Docs on hosting containers on AWS for teaching" class="md-header__button md-logo" aria-label="Docs on hosting containers on AWS for teaching" data-md-component="logo">
      
  <img src="assets/images/SIB_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docs on hosting containers on AWS for teaching
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docs
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/sib-swiss/AWS-docker" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    sib-swiss/AWS-docker
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Docs on hosting containers on AWS for teaching" class="md-nav__button md-logo" aria-label="Docs on hosting containers on AWS for teaching" data-md-component="logo">
      
  <img src="assets/images/SIB_logo.svg" alt="logo">

    </a>
    Docs on hosting containers on AWS for teaching
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sib-swiss/AWS-docker" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    sib-swiss/AWS-docker
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Docs
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Docs
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Generate credentials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploying containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-containers-based-on-jupyter-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy containers based on jupyter notebook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-containers-based-on-rstudio-server" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy containers based on Rstudio server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-containers-based-on-vscode-server" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy containers based on vscode server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restricting-resource-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Restricting resource usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-volume-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Container &amp; volume infrastructure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-admin-privileges" class="md-nav__link">
    <span class="md-ellipsis">
      How to use admin privileges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stopping-services" class="md-nav__link">
    <span class="md-ellipsis">
      Stopping services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-a-backup" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up a backup
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Generate credentials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploying containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-containers-based-on-jupyter-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy containers based on jupyter notebook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-containers-based-on-rstudio-server" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy containers based on Rstudio server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-containers-based-on-vscode-server" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy containers based on vscode server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restricting-resource-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Restricting resource usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#container-volume-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Container &amp; volume infrastructure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-admin-privileges" class="md-nav__link">
    <span class="md-ellipsis">
      How to use admin privileges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stopping-services" class="md-nav__link">
    <span class="md-ellipsis">
      Stopping services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-a-backup" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up a backup
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="hosting-containers-on-aws-for-teaching">Hosting containers on AWS for teaching</h1>
<p>Scripts to deploy multiple docker containers simultaneously for teaching. Below you will find the documentation. Are you new? Have a look at the <a href="tutorial/">tutorial</a></p>
<div class="admonition warning">
<p class="admonition-title">A note on security</p>
<p>The connections between the participant and the container will be through http, and are therefore <strong>not</strong> encrypted. Therefore:</p>
<ul>
<li>No sensitive data in the hosted container</li>
<li>Do not let participants choose their own password</li>
<li>Be careful with downloading executable files</li>
<li>Do not re-use the IP of the host machine</li>
<li>(If possible) restrict the IP from which to approach the host machine</li>
</ul>
<p>We are currently developing scripts and docs on how to host containers with a reverse proxy over https. You can find it here: <a href="https://github.com/GeertvanGeest/AWS-docker-nginx">https://github.com/GeertvanGeest/AWS-docker-nginx</a></p>
</div>
<h2 id="preparation">Preparation</h2>
<p>Start an AWS EC2 instance with an Ubuntu AMI. If you are new to this, <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/concepts.html">here</a> is a good place to get started. </p>
<p>Here&rsquo;s a <a href="https://github.com/GeertvanGeest/terraform-AWS-teaching">repository</a> that automates the start of an EC2 instance with <code>terraform</code>. </p>
<p>If docker is not pre-installed in your chosen AMI (it is pre-installed in e.g. the <a href="https://aws.amazon.com/marketplace/pp/prodview-dxk3xpeg6znhm">Ubuntu deep learning base AMI</a>), install docker on the instance:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>https://get.docker.com<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
sudo<span class="w"> </span>usermod<span class="w"> </span>-a<span class="w"> </span>-G<span class="w"> </span>docker<span class="w"> </span>ubuntu<span class="w"> </span><span class="c1"># ubuntu is the user with root access</span>
sudo<span class="w"> </span>service<span class="w"> </span>docker<span class="w"> </span>start
</code></pre></div>
<p>You can add the above code to the code run at initialisation. Otherwise, logout and login again to be able use <code>docker</code> without <code>sudo</code>.</p>
<p>After that, clone this repository:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/GeertvanGeest/AWS-docker.git
</code></pre></div>
<h2 id="generate-credentials">Generate credentials</h2>
<p>You can generate credentials from a comma separated list of users, with two columns: first name and last name. Do not use column names. Here&rsquo;s an example:</p>
<div class="highlight"><pre><span></span><code>Jan,de Wandelaar
Piet,Kopstoot
Joop,Zoetemelk
</code></pre></div>
<p>Run the script <code>generate_credentials.sh</code> like this (use <code>-l</code> to specify the user list):</p>
<div class="highlight"><pre><span></span><code>./generate_credentials<span class="w"> </span><span class="se">\</span>
-l<span class="w"> </span>examples/user_list_credentials.txt<span class="w"> </span><span class="se">\</span>
-o<span class="w"> </span>./credentials
-p<span class="w"> </span><span class="m">9001</span>
-a<span class="w"> </span><span class="m">18</span>.192.64.150
</code></pre></div>
<p>The option <code>-o</code> specifies an output directory in which the following files are created:</p>
<ul>
<li><code>input_docker_start.txt</code>: A file that serves as input to deploy the docker containers on the server</li>
<li><code>user_info.txt</code>: A file with user names, passwords and links that can be used to communicate credentials to the participants</li>
</ul>
<p>The option <code>-p</code> is used to generate an individual port for each user. Ports will be assigned in an increasing number from <code>-p</code> to each user. So, in the example above, the first user gets port 9001, the second 9002, the third 9003, etc. <strong>Be aware that port 9000 and 10000 are reserved for the admin containers!</strong></p>
<p>The option <code>-a</code> specifies the address on which the container will be hosted. This is used to generate the address per user. If you have already started your instance (or if you have an elastic IP), specify the public IPv4 address here. </p>
<h2 id="deploying-containers">Deploying containers</h2>
<p>The output generated by <code>generate_credentials</code> consists of two files. One of them is called <code>input_docker_start.txt</code> and  should look like this (if you wish, you can also choose to generate this yourself):</p>
<div class="highlight"><pre><span></span><code>9001    jdewandelaar    OZDRqwMRmkjKzM48v+I=
9002    pkopstoot   YTnSh6SmhsVUe+aC2HY=
9003    jzoetemelk  LadwVbiYY4rH0S5TjeI=
</code></pre></div>
<p>Each line will be used to start up a container hosted on the specified port and accessible with the specified password (third column). Once deployed, the jupyter notebook or rstudio server will be available through <code>[HOST IP]:[PORT]</code>. If you want to have both rstudio server and jupyter notebook running on the same instance, you can generate two tab-delimited files (one for rstudio and one for jupyter) and give them the same passwords for convenience. <strong>Note that each container uses a single port, so the files should contain different ports!</strong></p>
<h3 id="deploy-containers-based-on-jupyter-notebook">Deploy containers based on jupyter notebook</h3>
<p>Prepare an image that you want to use for the course. This image should be based on a jupyter notebook container, e.g. <a href="https://jupyter-docker-stacks.readthedocs.io/en/latest/using/selecting.html#jupyter-base-notebook">jupyter/base-notebook</a>, and should be available from <code>dockerhub</code>.</p>
<p>Run the script <code>run_jupyter_notebooks</code> on the server:</p>
<div class="highlight"><pre><span></span><code>run_jupyter_notebooks<span class="w"> </span><span class="se">\</span>
-i<span class="w"> </span>jupyter/base-notebook<span class="w"> </span><span class="se">\</span>
-u<span class="w"> </span>examples/credentials_jupyter/input_docker_start.txt<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span>test1234
</code></pre></div>
<p>Here, <code>-i</code> is the image tag, <code>-u</code> is the user list as generated by <code>./generate_credentials.sh</code>, and <code>-p</code> is the password for the admin container.
No username is required to log on to a jupyter notebook.</p>
<p>To access the admin container, go to <code>[HOST IP]:10000</code></p>
<h3 id="deploy-containers-based-on-rstudio-server">Deploy containers based on Rstudio server</h3>
<p>Prepare an image that you want to use for the course. This image should be based on a rocker image, e.g. <a href="https://hub.docker.com/r/rocker/rstudio">rocker/rstudio</a>, and should be available from <code>dockerhub</code>.</p>
<p>Run the script <code>run_rstudio_server</code> on the server:</p>
<div class="highlight"><pre><span></span><code>run_rstudio_server<span class="w"> </span><span class="se">\</span>
-i<span class="w"> </span>rocker/rstudio<span class="w"> </span><span class="se">\</span>
-u<span class="w"> </span>examples/credentials_rstudio/input_docker_start.txt<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span>test1234
</code></pre></div>
<p>See above for the meaning of the options.</p>
<p>The username to log on to rstudio server is <code>rstudio</code>.</p>
<p>To access the admin container, go to <code>[HOST IP]:9000</code></p>
<h3 id="deploy-containers-based-on-vscode-server">Deploy containers based on vscode server</h3>
<p>Prepare an image that you want to use for the course. This image should be based on a image <a href="https://hub.docker.com/r/linuxserver/code-server">linuxserver/code-server</a> image, and should be available from <code>dockerhub</code>.</p>
<p>In the docker file you can install code-server extensions with <code>/usr/local/bin/install-extension</code>. </p>
<p>Run the script <code>run_vscode_server</code> on the server:</p>
<div class="highlight"><pre><span></span><code>run_vscode_server<span class="w"> </span><span class="se">\</span>
-i<span class="w"> </span>linuxserver/code-server<span class="w"> </span><span class="se">\</span>
-u<span class="w"> </span>examples/credentials_vscode/input_docker_start.txt<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span>test1234
</code></pre></div>
<p>See above for the meaning of the options.</p>
<p>To access the admin container, go to <code>[HOST IP]:7000</code></p>
<h2 id="restricting-resource-usage">Restricting resource usage</h2>
<p>To prevent overcommitment of the server, it can be convenient to restrict resource usage per participant. You can do that with the options <code>-c</code> and <code>-m</code>, which are passed to the arguments <code>--cpus</code> and <code>--memory</code> of <code>docker run</code>. Use it like this:</p>
<div class="highlight"><pre><span></span><code>run_rstudio_server<span class="w"> </span><span class="se">\</span>
-i<span class="w"> </span>rocker/rstudio<span class="w"> </span><span class="se">\</span>
-u<span class="w"> </span>examples/credentials_rstudio/input_docker_start.txt<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span>test1234<span class="w"> </span><span class="se">\</span>
-c<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
-m<span class="w"> </span>4g
</code></pre></div>
<p>Resulting in a hard limit of 2 cpu and 4 Gb of memory for each user. By default these are 2 cpu and 16 Gb of memory. These restrictions are not applied to the admin container.</p>
<h2 id="container-volume-infrastructure">Container &amp; volume infrastructure</h2>
<p>There are three volumes mounted to each container:</p>
<ul>
<li>The volume <code>data</code> is mounted to <code>/data</code>. This volume is meant to harbour read-only data (e.g. raw data). </li>
<li>The volume <code>group_work</code> is mounted to <code>/group_work</code>. The group volume is meant as a shared directory, where everybody can read and write.</li>
<li>Each user has a personal volume, named after the username (output of <code>generate_credentials</code>). This volume is mounted to <code>/home/rstudio/workdir/</code> for rstudio, <code>/home/jovyan/workdir</code> for jupyter, and <code>/config/project</code> for vscode. </li>
</ul>
<p>Below you can find an example of the container infrastructure. Blue squares are containers, yellow are volumes. Arrows indicate accessibility. </p>
<p><img alt="container infrastructure" src="assets/images/infrastructure.png" /></p>
<h2 id="how-to-use-admin-privileges">How to use admin privileges</h2>
<p>The admin container (i.e. with sudo rights) is available from port 10000 for the jupyter containers and 9000 for the rstudio containers. The regular users at the ports specified in the tab-delimited text file.</p>
<p>You can check out a user volume with <code>mount_user_volume.sh</code>:</p>
<div class="highlight"><pre><span></span><code>./mount_user_volume.sh<span class="w"> </span>user01
</code></pre></div>
<p>This will create an ubuntu container directly accessing the home directory of user01. As an alternative to this ubuntu container, you can mount the user volume to any other container.</p>
<h2 id="stopping-services">Stopping services</h2>
<p>You can stop all services (containers and volumes) with the script <code>stop_services.sh</code>.</p>
<h2 id="setting-up-a-backup">Setting up a backup</h2>
<p>With the script <code>backup_s3.sh</code> you can sync files from the docker volumes to s3. It will sync the shared volume <code>group_work</code> and the invidual user volumes. In order to run the script, first configure AWS cli on the server:</p>
<div class="highlight"><pre><span></span><code>aws configure
</code></pre></div>
<p>More info about configuring AWS cli <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">here</a>. </p>
<p>After that, we can specify a cronjob, to sync these files regularly. The script <code>scripts/backup_s3_cronjob.sh</code> calls <code>backup_s3.sh</code> and can be used in your cronjob. To do this, first edit <code>scripts/backup_s3_cronjob.sh</code>:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="nb">cd</span><span class="w"> </span>/home/ubuntu
AWS-docker/backup_s3<span class="w"> </span><span class="se">\</span>
-u<span class="w"> </span><span class="o">[</span>CREDENTIALS<span class="w"> </span>input_docker_start.txt<span class="o">]</span><span class="w"> </span><span class="se">\</span>
-s<span class="w"> </span><span class="o">[</span>EXISTING<span class="w"> </span>S3<span class="w"> </span>BUCKET<span class="o">]</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="o">[</span>DIRECTORY<span class="w"> </span>IN<span class="w"> </span>THE<span class="w"> </span>BUCKET<span class="w"> </span><span class="o">(</span>newly<span class="w"> </span>created<span class="o">)]</span><span class="w"> </span><span class="se">\</span>
<span class="m">2</span>&gt;&gt;<span class="w"> </span>cronjob.err
</code></pre></div>
<p>Now run:</p>
<div class="highlight"><pre><span></span><code>crontab<span class="w"> </span>-e
</code></pre></div>
<p>And add a cronjob. E.g. for every hour you can add this line (use a full path to the cronjob script):</p>
<div class="highlight"><pre><span></span><code>0 * * * * /home/ubuntu/backup_s3_cronjob.sh
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>